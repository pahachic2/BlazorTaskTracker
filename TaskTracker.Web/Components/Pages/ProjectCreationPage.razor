@page "/projects"
@using TaskTracker.Models
@using TaskTracker.Models.DTOs
@using TaskTracker.Web.Components.UI
@inject NavigationManager NavigationManager
@inject IApiService ApiService
@inject OrganizationService OrganizationService
@inject ILocalStorageService LocalStorage
@inject IJSRuntime JSRuntime

<div class="w-screen h-screen flex bg-gray-50">
    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ -->
    <div class="sidebar-fixed bg-white shadow-lg border-r border-gray-200 @(isMobileMenuOpen ? "" : "sidebar-hidden lg:transform-none")">
        <ProjectSidebar Organizations="availableOrganizations"
            Projects="availableProjects"
            SelectedProject="selectedProject"
            UserName="@currentUserName"
            UserEmail="@currentUserEmail"
            OnProjectSelected="HandleProjectSelected"
            OnCreateProject="HandleCreateProject"
            OnCreateOrganization="HandleCreateOrganization"
            OnManageMembers="HandleManageMembers"
            OnCloseMobile="HandleCloseMobileMenu"
            OnLogout="HandleLogout" />
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    @if (isMobileMenuOpen)
    {
        <div class="fixed inset-0 z-40 lg:hidden">
            <div class="fixed inset-0 bg-gray-600 bg-opacity-75" @onclick="HandleCloseMobileMenu"></div>
        </div>
    }

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å (Main Content) -->
    <main class="main-with-sidebar flex-1 w-full h-full flex flex-col">
        <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="lg:hidden bg-white border-b border-gray-200 p-4">
            <div class="flex items-center justify-between">
                <button @onclick="HandleToggleMobileMenu"
                        class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <div class="flex-1 text-center">
                    <h1 class="text-lg font-semibold text-gray-900">
                        @(selectedProject?.Name ?? "TaskTracker")
                    </h1>
                </div>
                <div class="w-10 h-10"></div> <!-- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è -->
            </div>
        </div>

        @if (selectedProject != null)
        {
            <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Header -->
            <Header ProjectName="@selectedProject.Name"
                ProjectDescription="@selectedProject.Description"
                UserName="@currentUserName"
                UserEmail="@currentUserEmail"
                OnAddTaskClick="HandleAddTask"
                OnSearchChanged="HandleSearch"
                OnLogoutClick="HandleLogout" />

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            @if (showMembersPanel && !string.IsNullOrEmpty(selectedOrganizationIdForMembers))
            {
                <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div class="max-w-6xl mx-auto">
                        <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç—É" -->
                        <div class="mb-6">
                            <button @onclick="HandleBackToProject"
                                    class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                                –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç—É
                            </button>
                        </div>
                        
                        <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ -->
                        <OrganizationMembersPanel OrganizationId="@selectedOrganizationIdForMembers"
                                                  OnInvitationSent="HandleInvitationSent" />
                    </div>
                </div>
            }
            else
            {
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
                <div class="flex-1 overflow-hidden">
                    <div class="h-full overflow-x-auto overflow-y-hidden" style="max-width: 100vw;">
                        <div class="flex space-x-6 p-6 h-full" style="width: max-content; min-width: 100%;">
                            <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç KanbanBoard -->
                            <KanbanBoard @ref="kanbanBoardRef"
                                Columns="kanbanColumns"
                                OnTaskClick="HandleTaskClick"
                                OnAddTaskToColumn="HandleAddTaskToColumn"
                                OnAddColumn="HandleAddColumn"
                                OnTaskMoved="HandleTaskMoved"
                                OnTaskDelete="HandleTaskDelete"
                                OnColumnDelete="HandleColumnDelete"
                                OnTaskUpdate="HandleTaskUpdate"
                                OnColumnUpdate="HandleColumnUpdate" />
                        </div>
                    </div>
                </div>
            }
        }
        else if (!availableOrganizations.Any())
        {
            <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
            <div class="flex-1 flex items-center justify-center p-4">
                <div class="text-center max-w-md mx-auto">
                    <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TaskTracker!</h2>
                    <p class="text-gray-600 mb-6">
                        –°–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π.
                    </p>
                    <button @onclick="HandleCreateOrganization"
                            class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-lg font-medium">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        –°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
                    </button>
                </div>
            </div>
        }
        else
        {
            <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ -->
            <div class="flex-1 flex items-center justify-center p-4">
                <div class="text-center max-w-md mx-auto">
                    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h2a2 2 0 002-2z"></path>
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç</h2>
                    <p class="text-gray-600 mb-6">
                        –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–∑ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –≤ –æ–¥–Ω–æ–π –∏–∑ –≤–∞—à–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.
                    </p>
                </div>
            </div>
        }
    </main>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
<TaskCreateModal IsVisible="isCreateModalVisible"
    OnClose="HandleCloseCreateModal"
    OnTaskCreated="HandleTaskCreated" />

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ -->
<ProjectCreateModal IsVisible="isCreateProjectModalVisible"
    OrganizationId="@selectedOrganizationIdForNewProject"
    OnClose="HandleCloseProjectModal"
    OnProjectCreated="HandleProjectCreated" />

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
<OrganizationCreateModal IsVisible="isCreateOrganizationModalVisible"
    OnClose="HandleCloseOrganizationModal"
    OnOrganizationCreated="HandleOrganizationCreated" />

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ -->
<ColumnCreateModal IsVisible="isCreateColumnModalVisible"
    ProjectId="@(selectedProject?.Id ?? "")"
    MaxOrder="@kanbanColumns.Count"
    OnClose="HandleCloseColumnModal"
    OnColumnCreated="HandleColumnCreated" />

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
<TaskDeleteModal IsVisible="isDeleteTaskModalVisible"
    TaskToDelete="taskToDelete"
    OnCancel="HandleCancelDeleteTask"
    OnConfirm="HandleConfirmDeleteTask" />

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ -->
<ColumnDeleteModal IsVisible="isDeleteColumnModalVisible"
    ColumnToDelete="columnToDelete"
    OnCancel="HandleCancelDeleteColumn"
    OnConfirm="HandleConfirmDeleteColumn" />

@code {
    // –î–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    private List<Organization> availableOrganizations = new();
    
    // –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–∑ API
    private List<Project> availableProjects = new();
    private Project? selectedProject = null;

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è Kanban –¥–æ—Å–∫–∏ –∏–∑ API
    private List<KanbanColumn> kanbanColumns = new();

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    private bool isCreateModalVisible = false;
    private bool isCreateProjectModalVisible = false;
    private bool isCreateOrganizationModalVisible = false;
    private bool isCreateColumnModalVisible = false;
    private bool isDeleteTaskModalVisible = false;
    private bool isDeleteColumnModalVisible = false;

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    private bool showMembersPanel = false;
    private string selectedOrganizationIdForMembers = "";

    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    private bool isMobileMenuOpen = false;

    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    private string currentUserName = "";
    private string currentUserEmail = "";

    // ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
    private string selectedOrganizationIdForNewProject = "";

    // –ó–∞–¥–∞—á–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    private KanbanTask? taskToDelete = null;
    private KanbanColumn? columnToDelete = null;

    // –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç KanbanBoard –¥–ª—è –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ drag-and-drop
    private KanbanBoard? kanbanBoardRef;

    protected override async Task OnInitializedAsync()
    {
        await LoadUserDataAsync();
        await LoadOrganizationsAsync();
        await LoadProjectsAsync();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        if (availableProjects.Any())
        {
            selectedProject = availableProjects.First();
            await LoadProjectColumnsAsync();
        }
    }

    private async Task LoadUserDataAsync()
    {
        var userData = await LocalStorage.GetUserDataAsync();
        if (userData.IsAuthenticated)
        {
            currentUserName = userData.Username ?? "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
            currentUserEmail = userData.Email ?? "";
        }
        else
        {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
            NavigationManager.NavigateTo("/login");
        }
    }

    private async Task LoadOrganizationsAsync()
    {
        try
        {
            availableOrganizations = await OrganizationService.GetUserOrganizationsAsync();
            Console.WriteLine($"üè¢ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {availableOrganizations.Count} –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –∏–∑ API");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π: {ex.Message}");
            availableOrganizations = new List<Organization>();
        }
    }

    private async Task LoadProjectsAsync()
    {
        try
        {
            var projects = await ApiService.GetUserProjectsAsync();
            availableProjects = projects.Select(MapProjectResponseToProject).ToList();
            Console.WriteLine($"üìÇ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {availableProjects.Count} –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–∑ API");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤: {ex.Message}");
            availableProjects = new List<Project>();
        }
    }

    private async Task LoadProjectColumnsAsync()
    {
        if (selectedProject == null) return;

        try
        {
            Console.WriteLine($"üîÑ BLAZOR: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ {selectedProject.Id} ({selectedProject.Name})");
            
            var columns = await ApiService.GetProjectColumnsAsync(selectedProject.Id);
            kanbanColumns = columns.Select(MapColumnResponseToKanbanColumn).ToList();
            
            Console.WriteLine($"üìã BLAZOR: –ó–∞–≥—Ä—É–∂–µ–Ω–æ {kanbanColumns.Count} –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ {selectedProject.Name}");
            
            // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ - –ø–æ–∫–∞–∂–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ —á—Ç–æ –ø—Ä–∏—à–ª–∏ –∏–∑ API
            foreach (var column in kanbanColumns)
            {
                Console.WriteLine($"üìÇ BLAZOR: –ö–æ–ª–æ–Ω–∫–∞ '{column.Title}' (ID: {column.Id}) —Å–æ–¥–µ—Ä–∂–∏—Ç {column.Tasks.Count} –∑–∞–¥–∞—á:");
                foreach (var task in column.Tasks)
                {
                    Console.WriteLine($"   üìù –ó–∞–¥–∞—á–∞: {task.Title} (ID: {task.Id}, ColumnId: {task.ColumnId})");
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–æ–Ω–æ–∫: {ex.Message}");
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç—ã–µ –∫–æ–ª–æ–Ω–∫–∏
            kanbanColumns = new List<KanbanColumn>();
        }
    }

    // –ú–∞–ø–ø–∏–Ω–≥ DTO –≤ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    private static Project MapProjectResponseToProject(ProjectResponse response)
    {
        return new Project
        {
            Id = response.Id,
            Name = response.Name,
            Description = response.Description,
            Icon = response.Icon,
            Color = response.Color,
            OrganizationId = response.OrganizationId,
            Members = response.Members.ToList(),
            TaskCount = response.TaskCount,
            CreatedDate = response.CreatedDate
        };
    }

    private static KanbanColumn MapColumnResponseToKanbanColumn(ColumnResponse response)
    {
        return new KanbanColumn
        {
            Id = response.Id,
            Title = response.Title,
            Tasks = response.Tasks.Select(MapTaskResponseToKanbanTask).ToList()
        };
    }

    private static KanbanTask MapTaskResponseToKanbanTask(TaskResponse response)
    {
        return new KanbanTask
        {
            Id = response.Id,
            Title = response.Title,
            Description = response.Description,
            Tags = response.Tags.ToList(),
            Assignees = response.Assignees.ToList(),
            DueDate = response.DueDate,
            ColumnId = response.ColumnId
        };
    }

    // –û–±—Ä–∞—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ API
    private static CreateTaskRequest MapKanbanTaskToCreateRequest(KanbanTask task, string projectId)
    {
        return new CreateTaskRequest
        {
            Title = task.Title,
            Description = task.Description,
            Tags = task.Tags,
            Assignees = task.Assignees,
            DueDate = task.DueDate,
            ColumnId = task.ColumnId,
            ProjectId = projectId,
            Priority = TaskPriority.Medium
        };
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
    private async void HandleProjectSelected(Project project)
    {
        Console.WriteLine($"üéØ –í—ã–±—Ä–∞–Ω –ø—Ä–æ–µ–∫—Ç: {project.Name}");
        selectedProject = project;
        await LoadProjectColumnsAsync();
        StateHasChanged();
    }

    private void HandleCloseProjectModal()
    {
        isCreateProjectModalVisible = false;
    }

    private async void HandleProjectCreated(Project newProject)
    {
        Console.WriteLine($"‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç: {newProject.Name}");
        
        try
        {
            var createRequest = new CreateProjectRequest
            {
                Name = newProject.Name,
                Description = newProject.Description,
                Icon = newProject.Icon,
                Color = newProject.Color,
                OrganizationId = newProject.OrganizationId
            };

            var createdProject = await ApiService.CreateProjectAsync(createRequest);
            if (createdProject != null)
            {
                await LoadProjectsAsync(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
                selectedProject = availableProjects.FirstOrDefault(p => p.Id == createdProject.Id);
                await LoadProjectColumnsAsync();
                StateHasChanged();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: {ex.Message}");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è Header –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    private void HandleAddTask()
    {
        Console.WriteLine("üéØ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏");
        isCreateModalVisible = true;
    }

    private void HandleSearch(string searchQuery)
    {
        Console.WriteLine($"–ü–æ–∏—Å–∫: {searchQuery}");
    }

    private async Task HandleLogout()
    {
        await LocalStorage.ClearAuthDataAsync();
        NavigationManager.NavigateTo("/login");
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
    private void HandleCloseCreateModal()
    {
        Console.WriteLine("üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏");
        isCreateModalVisible = false;
    }

    private async void HandleTaskCreated(KanbanTask newTask)
    {
        if (selectedProject == null) return;

        Console.WriteLine($"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞: {newTask.Title}");

        try
        {
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É (To Do)
            var todoColumn = kanbanColumns.FirstOrDefault();
            if (todoColumn != null)
            {
                newTask.ColumnId = todoColumn.Id;
                var createRequest = MapKanbanTaskToCreateRequest(newTask, selectedProject.Id);
                
                var createdTask = await ApiService.CreateTaskAsync(createRequest);
                if (createdTask != null)
                {
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                    await LoadProjectColumnsAsync();
                    StateHasChanged();

                    // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º drag-and-drop –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                    if (kanbanBoardRef != null)
                    {
                        Console.WriteLine("üîÑ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag-and-drop –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏...");
                        await kanbanBoardRef.RefreshDragAndDrop();
                    }
                }
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏: {ex.Message}");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è KanbanBoard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    private void HandleTaskClick(KanbanTask task)
    {
        Console.WriteLine($"–ö–ª–∏–∫ –ø–æ –∑–∞–¥–∞—á–µ: {task.Title}");
    }

    private void HandleAddTaskToColumn(string columnId)
    {
        Console.WriteLine($"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –∫–æ–ª–æ–Ω–∫—É: {columnId}");
        // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏
        isCreateModalVisible = true;
    }

    private void HandleAddColumn()
    {
        Console.WriteLine("‚ûï –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏");
        isCreateColumnModalVisible = true;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏
    private void HandleCloseColumnModal()
    {
        isCreateColumnModalVisible = false;
    }

    private async void HandleColumnCreated(KanbanColumn newColumn)
    {
        Console.WriteLine($"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: {newColumn.Title}");
        
        if (selectedProject == null) return;
        
        try
        {
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è API
            var createRequest = new CreateColumnRequest
            {
                Title = newColumn.Title,
                ProjectId = selectedProject.Id,
                Order = newColumn.Order
            };

            Console.WriteLine($"üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ –≤ API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞: {selectedProject.Id}");
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ API
            var createdColumn = await ApiService.CreateColumnAsync(createRequest);
            
            if (createdColumn != null)
            {
                Console.WriteLine($"‚úÖ –ö–æ–ª–æ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –≤ API: {createdColumn.Title} (ID: {createdColumn.Id})");
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                await LoadProjectColumnsAsync();
                StateHasChanged();
            }
            else
            {
                Console.WriteLine($"‚ùå API –≤–µ—Ä–Ω—É–ª null –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–ª–æ–Ω–∫–∏ {newColumn.Title}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏: {ex.Message}");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    private void HandleCreateOrganization()
    {
        Console.WriteLine("üè¢ –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏");
        isCreateOrganizationModalVisible = true;
    }

    private void HandleCloseOrganizationModal()
    {
        isCreateOrganizationModalVisible = false;
    }

    private async void HandleOrganizationCreated(Organization newOrganization)
    {
        Console.WriteLine($"‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: {newOrganization.Name}");
        
        try
        {
            var createRequest = new CreateOrganizationRequest
            {
                Name = newOrganization.Name,
                Description = newOrganization.Description,
                Icon = newOrganization.Icon,
                Color = newOrganization.Color
            };

            var createdOrganization = await OrganizationService.CreateOrganizationAsync(createRequest);
            if (createdOrganization != null)
            {
                await LoadOrganizationsAsync(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
                StateHasChanged();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: {ex.Message}");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π
    private void HandleCreateProject(string organizationId)
    {
        Console.WriteLine($"‚ûï –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: {organizationId}");
        selectedOrganizationIdForNewProject = organizationId;
        isCreateProjectModalVisible = true;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    private void HandleManageMembers(string organizationId)
    {
        Console.WriteLine($"üë• –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: {organizationId}");
        selectedOrganizationIdForMembers = organizationId;
        showMembersPanel = true;
        StateHasChanged();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É
    private void HandleBackToProject()
    {
        Console.WriteLine("üîô –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ–µ–∫—Ç—É");
        showMembersPanel = false;
        selectedOrganizationIdForMembers = "";
        StateHasChanged();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
    private async Task HandleInvitationSent(InvitationResponse invitation)
    {
        Console.WriteLine($"üìß –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {invitation.Email}");
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ sidebar
        await LoadOrganizationsAsync();
        StateHasChanged();
    }

    // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
    private void HandleToggleMobileMenu()
    {
        isMobileMenuOpen = !isMobileMenuOpen;
        StateHasChanged();
    }

    private void HandleCloseMobileMenu()
    {
        isMobileMenuOpen = false;
        StateHasChanged();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–¥–∞—á
    private async Task HandleTaskMoved(TaskMovedEventArgs args)
    {
        Console.WriteLine($"üéØ BLAZOR: –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ {args.TaskId} –∏–∑ {args.FromColumnId} –≤ {args.ToColumnId}");
        
        try
        {
            // –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
            var moveRequest = new MoveTaskRequest
            {
                NewColumnId = args.ToColumnId,
                NewOrder = 0 // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–æ—Ä—è–¥–æ–∫
            };

            Console.WriteLine($"üì§ BLAZOR: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ API - TaskId: {args.TaskId}, NewColumnId: {args.ToColumnId}");
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ API
            var movedTask = await ApiService.MoveTaskAsync(args.TaskId, moveRequest);
            
            if (movedTask != null)
            {
                Console.WriteLine($"‚úÖ BLAZOR: –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ API: {movedTask.Title} -> ColumnId: {movedTask.ColumnId}");
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                await LoadProjectColumnsAsync();
                StateHasChanged();

                // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º drag-and-drop
                if (kanbanBoardRef != null)
                {
                    await kanbanBoardRef.RefreshDragAndDrop();
                }
            }
            else
            {
                Console.WriteLine($"‚ùå BLAZOR: API –≤–µ—Ä–Ω—É–ª null –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ {args.TaskId}");
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                await LoadProjectColumnsAsync();
                StateHasChanged();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå BLAZOR: –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏: {ex.Message}");
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            await LoadProjectColumnsAsync();
            StateHasChanged();
        }
    }



    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
    private void HandleTaskDelete(KanbanTask task)
    {
        Console.WriteLine($"üóëÔ∏è –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏: {task.Title}");
        taskToDelete = task;
        isDeleteTaskModalVisible = true;
    }

    private void HandleCancelDeleteTask()
    {
        Console.WriteLine("‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏");
        isDeleteTaskModalVisible = false;
        taskToDelete = null;
    }

    private async Task HandleConfirmDeleteTask(KanbanTask task)
    {
        Console.WriteLine($"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏: {task.Title}");
        
        try
        {
            Console.WriteLine($"üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ API: {task.Id}");
            
            var success = await ApiService.DeleteTaskAsync(task.Id);
            
            if (success)
            {
                Console.WriteLine($"‚úÖ –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ API: {task.Title}");
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                await LoadProjectColumnsAsync();

                // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º drag-and-drop
                if (kanbanBoardRef != null)
                {
                    Console.WriteLine("üîÑ –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag-and-drop –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏...");
                    await kanbanBoardRef.RefreshDragAndDrop();
                }
            }
            else
            {
                Console.WriteLine($"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É {task.Title}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏: {ex.Message}");
        }
        finally
        {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            isDeleteTaskModalVisible = false;
            taskToDelete = null;
            StateHasChanged(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            Console.WriteLine("üö™ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–æ");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏
    private void HandleColumnDelete(KanbanColumn column)
    {
        Console.WriteLine($"üóëÔ∏è –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏: {column.Title}");
        columnToDelete = column;
        isDeleteColumnModalVisible = true;
    }

    private void HandleCancelDeleteColumn()
    {
        Console.WriteLine("‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏");
        isDeleteColumnModalVisible = false;
        columnToDelete = null;
    }

    private async Task HandleConfirmDeleteColumn(KanbanColumn column)
    {
        Console.WriteLine($"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏: {column.Title}");
        
        try
        {
            Console.WriteLine($"üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ –≤ API: {column.Id}");
            
            var success = await ApiService.DeleteColumnAsync(column.Id);
            
            if (success)
            {
                Console.WriteLine($"‚úÖ –ö–æ–ª–æ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ API: {column.Title}");
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                await LoadProjectColumnsAsync();
                StateHasChanged();
            }
            else
            {
                Console.WriteLine($"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É {column.Title}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏: {ex.Message}");
        }
        finally
        {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            isDeleteColumnModalVisible = false;
            columnToDelete = null;
            StateHasChanged(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            Console.WriteLine("üö™ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–æ");
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á (inline editing)
    private async Task HandleTaskUpdate(KanbanTask task)
    {
        if (task == null)
        {
            Console.WriteLine("‚ùå –ü–æ–ª—É—á–µ–Ω–∞ –ø—É—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è");
            return;
        }

        try
        {
            Console.WriteLine($"üíæ –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞—á—É {task.Id}: Title='{task.Title}', DueDate={task.DueDate}");

            var updateRequest = new UpdateTaskRequest
            {
                Title = task.Title,
                Description = task.Description,
                Tags = task.Tags ?? new List<string>(),
                AssigneeIds = task.AssigneeIds ?? new List<string>(),
                DueDate = task.DueDate,
                Priority = task.Priority,
                Status = task.Status
            };

            await ApiService.UpdateTaskAsync(task.Id, updateRequest);
            Console.WriteLine($"‚úÖ –ó–∞–¥–∞—á–∞ {task.Id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞");

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            await LoadProjectColumnsAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ {task.Id}: {ex.Message}");
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            await JSRuntime.InvokeVoidAsync("alert", $"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π: {ex.Message}");
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            await LoadProjectColumnsAsync();
            
            throw; // –ü–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ KanbanBoard
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ (inline editing)
    private async Task HandleColumnUpdate(KanbanColumn column)
    {
        if (column == null)
        {
            Console.WriteLine("‚ùå –ü–æ–ª—É—á–µ–Ω–∞ –ø—É—Å—Ç–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è");
            return;
        }

        try
        {
            Console.WriteLine($"üíæ –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É {column.Id}: Title='{column.Title}'");

            var updateRequest = new UpdateColumnRequest
            {
                Title = column.Title,
                Order = column.Order
            };

            await ApiService.UpdateColumnAsync(column.Id, updateRequest);
            Console.WriteLine($"‚úÖ –ö–æ–ª–æ–Ω–∫–∞ {column.Id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞");

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            await LoadProjectColumnsAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–æ–Ω–∫–∏ {column.Id}: {ex.Message}");
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            await JSRuntime.InvokeVoidAsync("alert", $"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–ª–æ–Ω–∫–∏: {ex.Message}");
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            await LoadProjectColumnsAsync();
            
            throw; // –ü–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ KanbanBoard
        }
    }
}
